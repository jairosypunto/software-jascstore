{% load static humanize %}

<div class="vista-rapida-contenido" data-mode="quick">

  <!-- âŒ CERRAR -->
  <button class="cerrar-panel" aria-label="Cerrar">âœ•</button>

  <!-- =========================
       ðŸ“¸ GALERÃA
  ========================== -->
  <div class="galeria-producto">

    <!-- VISOR PRINCIPAL -->
    <div class="imagen-principal" id="visor-principal">
      {% if producto.image %}
        <img src="{{ producto.image.url }}"
             class="big-image"
             alt="{{ producto.name }}">
      {% else %}
        <img src="{% static 'icons/no-image.png' %}"
             class="big-image"
             alt="Sin imagen">
      {% endif %}
    </div>

    <!-- MINIATURAS -->
    <div class="miniaturas-horizontal">

      {% if producto.image %}
        <div class="miniatura activa"
             data-type="image"
             data-src="{{ producto.image.url }}">
          <img src="{{ producto.image.url }}" alt="Imagen principal">
        </div>
      {% endif %}

      {% for img in producto.images.all %}
        <div class="miniatura"
             data-type="image"
             data-src="{{ img.image.url }}">
          <img src="{{ img.image.url }}" alt="Imagen extra">
        </div>
      {% endfor %}

      {% if producto.video_file or producto.video_url %}
        <div class="miniatura video-thumb"
             data-type="video"
             data-src="{% if producto.video_file %}{{ producto.video_file.url }}{% else %}{{ producto.video_url }}{% endif %}"
             data-poster="{% if producto.video_thumb and producto.video_thumb.url %}{{ producto.video_thumb.url }}{% else %}{% static 'imgs/video-placeholder.jpg' %}{% endif %}">
          {% if producto.video_thumb and producto.video_thumb.url %}
            <img src="{{ producto.video_thumb.url }}" alt="Video">
          {% else %}
            <img src="{% static 'imgs/video-placeholder.jpg' %}" alt="Video">
          {% endif %}
        </div>
      {% endif %}

    </div>
  </div>

  <!-- =========================
       â„¹ï¸ INFO + CARRITO
  ========================== -->
  <div class="info-producto">

    <h3 class="titulo">{{ producto.name }}</h3>
    <p class="descripcion">{{ producto.description }}</p>

    <!-- SimulaciÃ³n de reseÃ±as y ventas -->
    <div class="reseÃ±as-ventas mb-2">
      <span class="estrella">â˜…â˜…â˜…â˜…â˜…</span>
      <span class="texto-reseÃ±as">1.2K reseÃ±as</span>
      <span class="texto-ventas">| 3.5K+ ventas</span>
    </div>

    <!-- PRECIOS -->
    {% if producto.discount > 0 %}
      <div class="precio">
        <span class="precio-final">${{ producto.final_price|intcomma }}</span>
        <span class="precio-original">${{ producto.cost|intcomma }}</span>
        <span class="badge-descuento">-{{ producto.discount }}%</span>
      </div>
    {% else %}
      <div class="precio">
        <span class="precio-final">${{ producto.cost|intcomma }}</span>
      </div>
    {% endif %}

    <!-- TALLAS -->
    {% if producto.talla_list %}
      <div class="bloque-opciones">
        <label class="label-opcion">Tallas</label>
        <div class="opciones">
          {% for talla in producto.talla_list %}
            <button type="button" class="option-chip size-chip">
              {{ talla }}
            </button>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <!-- COLORES -->
    {% if producto.color_list %}
      <div class="bloque-opciones">
        <label class="label-opcion">Colores</label>
        <div class="opciones">
          {% for color in producto.color_list %}
            <button type="button" class="option-chip color-chip">
              {{ color }}
            </button>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <!-- FORM CARRITO -->
    <form method="POST"
          action="{% url 'store:agregar_al_carrito' producto.id %}"
          id="form-add-cart">
      {% csrf_token %}
      <input type="hidden" name="selected_size_hidden">
      <input type="hidden" name="selected_color_hidden">
      <input type="hidden" name="cantidad" value="1">

      <button type="submit" class="btn-agregar" disabled>
        ðŸ›’ Agregar al carrito
      </button>
    </form>

  </div>
</div>