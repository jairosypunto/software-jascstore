{% load static humanize %}

<div class="vista-rapida-contenido" data-mode="quick" id="contenidoProducto">

  <button class="cerrar-panel" aria-label="Cerrar">âœ•</button>

  <div class="galeria-producto">

    <div class="imagen-principal" id="visor-principal">
      {% if producto.image %}
        <img src="{{ producto.image.url }}" id="imagen-principal"
             class="big-image" alt="{{ producto.name }}">
      {% else %}
        <img src="{% static 'icons/no-image.png' %}" id="imagen-principal"
             class="big-image" alt="Sin imagen">
      {% endif %}
    </div>

    <div class="miniaturas-horizontal">
      {% if producto.image %}
        <div class="miniatura activa activa-azul" 
             data-type="image" 
             data-src="{{ producto.image.url }}"
             data-color="base">
          <img src="{{ producto.image.url }}" alt="Imagen principal">
        </div>
      {% endif %}

      {% for img in producto.images.all %}
        <div class="miniatura" 
             data-type="image" 
             data-src="{{ img.image.url }}"
             data-color="{{ img.color_vinculado|default:'' }}">
          <img src="{{ img.image.url }}" alt="Imagen extra">
        </div>
      {% endfor %}
    </div>
  </div>

  <div class="info-producto">
    <h3 class="titulo">{{ producto.name }}</h3>
    <p class="descripcion">{{ producto.description }}</p>

    <div class="precio">
      {% if producto.discount > 0 %}
        <span class="precio-final">${{ producto.final_price|floatformat:0|intcomma }}</span>
        <span class="precio-original">${{ producto.cost|floatformat:0|intcomma }}</span>
        <span class="badge-descuento">-{{ producto.discount }}%</span>
      {% else %}
        <span class="precio-final">${{ producto.cost|floatformat:0|intcomma }}</span>
      {% endif %}
    </div>

    {% if producto.talla_list %}
      <div class="bloque-opciones">
        <label class="label-opcion">Tallas</label>
        <div class="opciones">
          {% for talla in producto.talla_list %}
            <button type="button" class="option-chip size-chip">{{ talla }}</button>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {% if producto.color_list %}
      <div class="bloque-opciones">
        <label class="label-opcion">Colores</label>
        <div class="opciones">
          {% for color in producto.color_list %}
            <button type="button" class="option-chip color-chip">{{ color }}</button>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <form id="form-add-cart">
      {% csrf_token %}
      <input type="hidden" name="selected_size_hidden" id="selected_size_hidden">
      <input type="hidden" name="selected_color_hidden" id="selected_color_hidden">
      <input type="hidden" name="imagen_seleccionada_url" id="imagen_seleccionada_url" value="{{ producto.image.url }}">
      <input type="hidden" name="cantidad" value="1">

      <button type="button" 
              id="agregarDesdeModal" 
              data-id="{{ producto.id }}"
              class="btn-agregar" 
              disabled>
        ðŸ›’ Agregar al carrito
      </button>
    </form>
  </div>
</div>