{% extends 'base.html' %}
{% load static %}

{% block title %}Nuestra Tienda - LatinShop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'store/css/store.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
{% endblock %}

{% block content %}
<!-- üé® Encabezado visual -->
<div class="bg-gradient text-white text-center py-4" style="background: linear-gradient(to right, #6a11cb, #2575fc);">
  <h2 class="fw-bold">Nuestra Tienda</h2>
  <p class="lead">Descubre productos incre√≠bles con los mejores precios</p>
</div>

<div class="container mt-4">
  <!-- üéØ Filtros -->
  <form method="get" action="{% url 'store:store' %}" class="row row-cols-1 row-cols-md-5 g-3 mb-4 align-items-center">
    <div class="col">
      <input type="text" name="q" class="form-control" placeholder="Buscar productos..." value="{{ request.GET.q }}">
    </div>
    <div class="col">
      <select name="category" class="form-select">
        <option value="all">Todas las categor√≠as</option>
       {% for category in categorias %}
          <option value="{{ category.slug }}"
            {% if categoria_actual and categoria_actual.slug == category.slug %}selected{% endif %}>
            {{ category.name }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="col">
      <select name="order" class="form-select">
        <option value="">Ordenar por...</option>
        <option value="name" {% if request.GET.order == 'name' %}selected{% endif %}>Nombre</option>
        <option value="price" {% if request.GET.order == 'price' %}selected{% endif %}>Precio ascendente</option>
        <option value="price_desc" {% if request.GET.order == 'price_desc' %}selected{% endif %}>Precio descendente</option>
        <option value="recent" {% if request.GET.order == 'recent' %}selected{% endif %}>M√°s reciente</option>
      </select>
    </div>
    <div class="col">
      <button type="submit" class="btn btn-primary w-100">Aplicar filtros</button>
    </div>
  </form>

  <!-- üì¶ Contador -->
  <p class="text-muted text-center">Mostrando {{ productos|length }} productos</p>

  <!-- üõçÔ∏è Tarjetas -->
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
    {% for producto in productos %}
      <div class="col">
        <div class="card h-100 shadow-sm position-relative {% if not producto.is_available %}border-danger{% endif %}">
          
          {% if producto.image %}
            <img src="{{ producto.image.url }}" class="card-img-top img-fluid" alt="{{ producto.name }}">
          {% else %}
            <img src="{% static 'store/img/default.jpg' %}" class="card-img-top img-fluid" alt="Sin imagen">
          {% endif %}

          {% if producto.nuevo %}
            <span class="badge bg-success position-absolute top-0 start-0 m-2">NUEVO</span>
          {% endif %}
          {% if producto.destacado %}
            <span class="badge bg-warning text-dark position-absolute top-0 end-0 m-2">‚≠ê DESTACADO</span>
          {% endif %}

          <div class="card-body text-center">
            <h5 class="card-title fw-bold">{{ producto.name }}</h5>
            <p class="card-text">
              <strong>Categor√≠a:</strong> {{ producto.category.nombre_categoria }}<br>
              {% if producto.description %}
                <strong>Material:</strong> {{ producto.description|truncatewords:10 }}<br>
              {% endif %}
              <strong>Precio:</strong> ${{ producto.cost|floatformat:0 }}<br>
              <strong>Estado:</strong>
              {% if producto.is_available %}
                <span class="text-success fw-bold">Disponible</span>
              {% else %}
                <span class="text-danger fw-bold">No disponible</span>
              {% endif %}
            </p>

            {% if producto.is_available and producto.stock > 0 %}
              <a href="{% url 'store:agregar_al_carrito' producto.id %}" class="btn btn-success w-100">Agregar</a>
            {% else %}
              <button class="btn btn-secondary w-100" disabled>No disponible</button>
            {% endif %}
          </div>
        </div>
      </div>
{% empty %}
{% if sugerencias %}
  <div class="mt-4">
    <h5 class="text-center text-primary">üîé Sugerencias similares</h5>
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
      {% for producto in sugerencias %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            {% if producto.image %}
              <img src="{{ producto.image.url }}" class="card-img-top img-fluid" alt="{{ producto.name }}">
            {% else %}
              <img src="{% static 'store/img/default.jpg' %}" class="card-img-top img-fluid" alt="Sin imagen">
            {% endif %}
            <div class="card-body text-center">
              <h5 class="card-title">{{ producto.name }}</h5>
              <p class="card-text fw-bold">${{ producto.cost|floatformat:0 }}</p>
              <a href="{% url 'store:agregar_al_carrito' producto.id %}" class="btn btn-outline-primary btn-sm">Agregar</a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endif %}
{% endfor %}
  </div>
</div>
{% endblock %}