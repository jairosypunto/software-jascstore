{% extends 'base.html' %}
{% load static %}
{% load l10n %}
{% load humanize %}

{% block title %}Nuestra Tienda - JascStore{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'store/css/banner.css' %}?v={{ STATIC_VERSION }}">
<link rel="stylesheet" href="{% static 'store/css/store.css' %}?v={{ STATIC_VERSION }}">
<link rel="stylesheet" href="{% static 'store/css/estilos_productos_tienda.css' %}?v={{ STATIC_VERSION }}">

<style>
    :root {
        --azul-premium: #1a237e;
        --azul-acento: #3949ab;
        --blanco-puro: #ffffff;
    }

    /* ðŸ’Ž BANNER MEJORADO */
    .banner-caption h2 {
        font-weight: 800;
        font-size: 3rem;
        text-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }

    .btn-premium-banner {
        background-color: var(--azul-premium);
        border: none;
        padding: 12px 30px;
        border-radius: 50px;
        transition: all 0.3s;
    }

    .btn-premium-banner:hover {
        background-color: var(--azul-acento);
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    /* ðŸ”Ž BARRA DE BÃšSQUEDA PROFESIONAL */
    .search-container-premium {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 25px rgba(26, 35, 126, 0.08);
        margin-top: -40px;
        position: relative;
        z-index: 100;
    }

    .form-control, .form-select {
        border: 1px solid #e0e0e0;
        padding: 12px;
        border-radius: 10px;
    }

    /* ðŸ‘Ÿ PRODUCT CARDS ESTILO BOUTIQUE */
    .product-card {
        border: none !important;
        border-radius: 18px !important;
        transition: all 0.4s ease;
        background: white;
        overflow: hidden;
    }

    .product-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 35px rgba(26, 35, 126, 0.12) !important;
    }

    .product-image-wrapper {
        position: relative;
        background: #f8f9fa;
        aspect-ratio: 1/1;
        cursor: pointer;
        overflow: hidden;
    }

    /* âœ… Efecto Zoom JascStore */
    .product-image-wrapper:hover .product-img {
        transform: scale(1.1);
        filter: brightness(0.9);
    }

    .product-img {
        mix-blend-mode: multiply; 
        transition: all 0.5s ease;
    }

    /* ðŸ”˜ BOTONES FLOTANTES EN CARD */
    .quick-view, .jasc-cart {
        background: white !important;
        color: var(--azul-premium) !important;
        border: none !important;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        transition: all 0.3s;
    }

    .quick-view:hover, .jasc-cart:hover {
        background: var(--azul-premium) !important;
        color: white !important;
    }

    /* ðŸ’¬ WHATSAPP PREMIUM */
    .btn-whatsapp {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: #25D366;
        color: white;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 30px;
        box-shadow: 0 10px 25px rgba(37, 211, 102, 0.4);
        z-index: 1000;
        transition: all 0.3s;
    }

    .btn-whatsapp:hover {
        transform: scale(1.1) rotate(10deg);
        color: white;
    }
</style>
{% endblock %}

{% block banner_full %}
<div class="full-bleed">
  <div class="swiper bannerSwiper">
    <div class="swiper-wrapper">
      {% for banner in banners %}
      <div class="swiper-slide">
        <div class="banner-bg" style="background-image: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url('{{ banner.image.url }}')"></div>
        <div class="banner-caption text-center">
          <span class="text-uppercase fw-bold mb-2 d-block" style="letter-spacing: 3px; color: var(--dorado-suave);">Exclusivo</span>
          <h2>{{ banner.title }}</h2>
          <p class="fs-5 opacity-75">{{ banner.subtitle }}</p>
          <a href="#productos" class="btn btn-premium-banner btn-lg text-white mt-3 shadow">
            Explorar ColecciÃ³n <i class="bi bi-arrow-right ms-2"></i>
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="swiper-pagination"></div>
  </div>
</div>
{% endblock %}

{% block content %}
<section class="shop-section">
  <div class="container">

    <div class="search-container-premium mb-5">
        <form method="get" class="row g-2">
          <div class="col-lg-4 col-md-12">
            <div class="input-group">
                <span class="input-group-text bg-transparent border-end-0"><i class="bi bi-search"></i></span>
                <input type="text" name="q" value="{{ search_query }}" placeholder="Buscar en la tienda..." class="form-control border-start-0">
            </div>
          </div>
          <div class="col-lg-3 col-md-4">
            <select name="category" class="form-select border-0 bg-light">
                <option value="all">Todas las categorÃ­as</option>
                {% for cat in categorias %}
                <option value="{{ cat.slug }}" {% if categoria_actual.slug == cat.slug %}selected{% endif %}>{{ cat.name }}</option>
                {% endfor %}
            </select>
          </div>
          <div class="col-lg-3 col-md-4">
            <select name="order" class="form-select border-0 bg-light">
                <option value="">Ordenar por...</option>
                <option value="price" {% if order == 'price' %}selected{% endif %}>Menor Precio</option>
                <option value="price_desc" {% if order == 'price_desc' %}selected{% endif %}>Mayor Precio</option>
                <option value="recent" {% if order == 'recent' %}selected{% endif %}>Novedades</option>
            </select>
          </div>
          <div class="col-lg-2 col-md-4">
            <button class="btn btn-premium-banner w-100 text-white fw-bold">Filtrar</button>
          </div>
        </form>
    </div>

    <div class="d-flex align-items-center gap-3 mb-4">
        <h2 class="section-title mb-0 fw-bold" style="color: var(--azul-premium);">âœ¨ Destacados</h2>
        <div class="flex-grow-1 border-bottom" style="opacity: 0.1;"></div>
    </div>

    <div class="swiper destacados-swiper mb-5 pb-4">
      <div class="swiper-wrapper">
        {% for producto in productos_destacados %}
        <div class="swiper-slide">
          <div class="destacado-card border shadow-sm rounded-4 overflow-hidden bg-white" 
               onclick="abrirVistaRapida('{{ producto.id }}')" style="cursor:pointer;">
            <div class="ratio ratio-1x1">
                <img src="{{ producto.image.url }}" class="object-fit-cover" alt="{{ producto.name }}">
            </div>
            <div class="p-3 text-center">
              <h5 class="fw-bold mb-1 text-truncate">{{ producto.name }}</h5>
              <span class="text-primary fw-bold h5">${{ producto.final_price|floatformat:0|intcomma }}</span>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    
    <div class="d-flex align-items-center gap-3 mb-4">
        <h2 class="section-title mb-0 fw-bold" style="color: var(--azul-premium);">ðŸ›’ CatÃ¡logo Completo</h2>
        <div class="flex-grow-1 border-bottom" style="opacity: 0.1;"></div>
    </div>

    <div class="row g-4" id="productos">
      {% for product in productos %}
      <div class="col-6 col-md-4 col-lg-3">
        <article class="product-card shadow-sm h-100">
          <div class="product-image-wrapper" onclick="abrirVistaRapida('{{ product.id }}')">
            <img src="{{ product.image.url }}" class="product-img w-100" alt="{{ product.name }}">
            
            <div class="product-actions position-absolute bottom-0 start-0 w-100 p-2 d-flex justify-content-center gap-2">
                <button type="button" class="jasc-cart btn rounded-circle" 
                        data-id="{{ product.id }}" 
                        data-has-variants="{{ product.has_variants|yesno:'true,false' }}"
                        onclick="event.stopPropagation();">
                    <i class="bi bi-cart-plus"></i>
                </button>
            </div>

            {% if product.discount > 0 %}
                <span class="badge bg-danger position-absolute top-0 end-0 m-3 shadow">-{{ product.discount }}%</span>
            {% endif %}
          </div>

          <div class="product-content p-3 text-center">
            <h3 class="h6 fw-bold text-dark text-truncate mb-2" 
                onclick="abrirVistaRapida('{{ product.id }}')" 
                style="cursor:pointer;">{{ product.name }}</h3>
            <div class="price-box">
              {% if product.discount > 0 %}
                <span class="text-danger fw-bold fs-5">${{ product.final_price|floatformat:0|intcomma }}</span>
                <small class="text-muted text-decoration-line-through d-block">${{ product.cost|floatformat:0|intcomma }}</small>
              {% else %}
                <span class="fw-bold fs-5 text-dark">${{ product.cost|floatformat:0|intcomma }}</span>
              {% endif %}
            </div>
          </div>
        </article>
      </div>
      {% endfor %}
    </div>

    <div class="vista-rapida-overlay hidden"></div>
    <div id="vistaRapidaPanel" class="vista-rapida-panel hidden">
      <button type="button" class="cerrar-panel">&times;</button>
      <div id="contenidoProducto"></div>
    </div>

  </div>
</section>

<a href="https://wa.me/573016173378?text=Hola!%20Vengo%20de%20la%20tienda%20y%20tengo%20una%20duda."
   class="btn-whatsapp shadow-lg" target="_blank">
   <i class="bi bi-whatsapp"></i>
</a>
{% endblock %}