{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<style>
    :root {
        --azul-premium: #1a237e; /* Tu Azul Hermoso */
        --azul-claro: #e8eaf6;
    }
    .card-factura {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        background-color: white;
    }
    .header-premium {
        background-color: var(--azul-premium);
        color: white;
        padding: 30px;
    }
    .table-premium thead {
        background-color: #f8f9fa;
        color: var(--azul-premium);
        border-bottom: 2px solid var(--azul-premium);
    }
    .img-producto {
        border-radius: 8px;
        border: 1px solid #ddd;
        object-fit: cover;
    }
    .badge-variante {
        background-color: var(--azul-claro);
        color: var(--azul-premium);
        font-size: 0.75rem;
        padding: 4px 8px;
        border-radius: 5px;
        margin-right: 5px;
    }

    /* ESTILOS DE IMPRESIÃ“N PROFESIONAL */
    @media print {
        @page { size: portrait; margin: 1cm; }
        .no-print, nav, footer, .btn, .d-flex.justify-content-center, hr.no-print {
            display: none !important;
        }
        .container {
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
            max-width: 100% !important;
        }
        .card-factura {
            box-shadow: none !important;
            border: none !important;
        }
        .header-premium {
            background-color: var(--azul-premium) !important;
            -webkit-print-color-adjust: exact;
            color: white !important;
        }
        .table-premium thead {
            background-color: #f8f9fa !important;
            -webkit-print-color-adjust: exact;
        }
        body { background-color: white !important; }
    }
</style>

<div class="container mt-5 mb-5">
    <div class="card card-factura shadow-lg" id="factura-imprimir">
        <div class="header-premium">
            <div class="row align-items-center">
                <div class="col-md-6 text-start">
                    <h2 class="fw-bold mb-0">JascStore</h2>
                    <p class="small mb-0 opacity-75">NIT: 900.XXX.XXX-1</p>
                </div>
                <div class="col-md-6 text-md-end mt-2 mt-md-0">
                    <h3 class="fw-light mb-0">Factura #{{ factura.id }}</h3>
                    <p class="small mb-0 opacity-75">{{ factura.fecha|date:"d F, Y" }}</p>
                </div>
            </div>
        </div>
        
        <div class="card-body p-4 p-md-5">
            <div class="alert alert-success border-0 shadow-sm text-center py-3 no-print" style="background-color: #e8f5e9; color: #2e7d32;">
                <i class="bi bi-check-circle-fill me-2"></i> Â¡Pago aprobado! Tu pedido ha sido procesado con Ã©xito.
            </div>

            <div class="row mb-4 mt-2">
                <div class="col-6">
                    <h6 class="text-muted text-uppercase fw-bold small">Facturado a:</h6>
                    <p class="mb-0 fw-bold" style="color: var(--azul-premium);">{{ factura.nombre }}</p>
                    <p class="small mb-0 text-muted">{{ factura.email }}</p>
                    <p class="small mb-0 text-muted">{{ factura.telefono }}</p>
                </div>
                <div class="col-6 text-end">
                    <h6 class="text-muted text-uppercase fw-bold small">EnvÃ­o a:</h6>
                    <p class="mb-0">{{ factura.direccion }}</p>
                    <p class="small mb-0">{{ factura.ciudad }}, {{ factura.departamento }}</p>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table align-middle table-premium">
                    <thead>
                        <tr>
                            <th class="no-print">Imagen</th>
                            <th>DescripciÃ³n</th>
                            <th class="text-center">Cant.</th>
                            <th class="text-end">Unitario</th> 
                            <th class="text-end">Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in factura.detalles.all %}
                        <tr>
                            <td class="no-print" style="width: 80px;">
                                {% if item.imagen_url %}
                                    <img src="{{ item.imagen_url }}" width="60" height="60" class="img-producto">
                                {% endif %}
                            </td>
                            <td>
                                <span class="fw-bold d-block" style="color: var(--azul-premium);">{{ item.producto.name }}</span>
                                <span class="text-muted small">Talla: {{ item.talla|default:"N/A" }} | Color: {{ item.color|default:"N/A" }}</span>
                            </td>
                            <td class="text-center">{{ item.cantidad }}</td>
                            <td class="text-end text-muted">
                                $ {% widthratio item.subtotal item.cantidad 1 as precio_u %}
                                {{ precio_u|floatformat:0|intcomma }}
                            </td>
                            <td class="text-end fw-bold">${{ item.subtotal|floatformat:0|intcomma }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot class="border-top">
                        <tr>
                            <th colspan="3" class="no-print"></th>
                            <th class="text-end pt-4 h5">Total Pagado:</th>
                            <th class="text-end pt-4 h4 fw-bold" style="color: var(--azul-premium);">${{ factura.total|floatformat:0|intcomma }}</th>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="text-center mt-5 no-print">
                <hr class="mb-4" style="opacity: 0.1;">
                <p class="mb-3 fw-bold" style="color: var(--azul-premium);">Â¿QuÃ© te gustarÃ­a hacer ahora?</p>
                
                <div class="mb-4 d-grid d-md-block gap-2">
                    <button onclick="window.print()" class="btn btn-lg shadow" 
                            style="background-color: var(--azul-premium); color: white; border-radius: 50px; padding: 12px 40px; font-weight: bold; border: none;">
                        ðŸ“„ DESCARGAR FACTURA PDF
                    </button>
                </div>

                <div class="d-flex justify-content-center gap-3">
                    <a href="{% url 'store:store' %}" class="btn btn-outline-primary px-4" style="border-radius: 50px; border-color: var(--azul-premium); color: var(--azul-premium);">
                        Seguir Comprando
                    </a>
                    <a href="{% url 'store:mis_facturas' %}" class="btn btn-outline-dark px-4" style="border-radius: 50px;">
                        Mis Pedidos
                    </a>
                </div>
            </div>
            
            <div class="mt-5 pt-4 border-top text-center text-muted small">
                <p class="mb-0">Gracias por elegir a <strong>JascStore</strong>. Si tienes dudas sobre tu pedido, contÃ¡ctanos por WhatsApp.</p>
                <p>Este documento es un comprobante de pago vÃ¡lido.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}