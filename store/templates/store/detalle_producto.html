{% extends 'base.html' %}
{% load static %}

{% block title %}{{ producto.name }} | JascShop{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row g-4">

    <!-- ðŸ–¼ VISOR PRINCIPAL -->
    <div class="col-md-6">
      <div id="imagen-principal" class="imagen-principal mb-3 text-center">
        <!-- El visor se llenarÃ¡ dinÃ¡micamente con JS -->
      </div>

      <!-- Miniaturas -->
      <div class="d-flex gap-2 justify-content-center flex-wrap mt-3">
        {% if producto.image %}
          <img src="{{ producto.image.url }}"
               class="miniatura activa"
               data-type="image"
               data-src="{{ producto.image.url }}">
        {% endif %}

        {% for img in producto.images.all %}
          <img src="{{ img.image.url }}"
               class="miniatura"
               data-type="image"
               data-src="{{ img.image.url }}">
        {% endfor %}

        {% if producto.video_file %}
          <img src="{{ producto.video_thumb.url }}"
               class="miniatura"
               data-type="video"
               data-src="{{ producto.video_file.url }}"
               data-poster="{{ producto.video_thumb.url }}">
        {% endif %}

        {% if producto.video_url %}
          <img src="{{ producto.video_thumb.url }}"
               class="miniatura"
               data-type="video"
               data-src="{{ producto.video_url }}"
               data-poster="{{ producto.video_thumb.url }}">
        {% endif %}
      </div>
    </div>

    <!-- ðŸ“„ INFO PRODUCTO -->
    <div class="col-md-6">
      <h2 class="fw-bold">{{ producto.name }}</h2>
      <p class="text-muted">{{ producto.description }}</p>

      {% if producto.discount > 0 %}
        <p class="fs-4 text-danger fw-bold">
          ${{ producto.final_price|floatformat:0 }}
        </p>
        <p class="text-muted text-decoration-line-through">
          ${{ producto.cost|floatformat:0 }}
        </p>
      {% else %}
        <p class="fs-4 fw-bold">
          ${{ producto.cost|floatformat:0 }}
        </p>
      {% endif %}

      <!-- ================= FORMULARIO AGREGAR AL CARRITO ================= -->
      <form method="POST"
            action="{% url 'store:agregar_al_carrito' producto.id %}"
            id="form-add-cart"
            data-product-id="{{ producto.id }}">
        {% csrf_token %}

        <!-- ================= TALLAS ================= -->
        {% if producto.talla_list %}
        <div class="mb-3">
          <label class="fw-bold">Tallas:</label>
          <div class="d-flex gap-2 flex-wrap">
            {% for talla in producto.talla_list %}
            <label class="option-chip size-chip">
              <input type="radio"
                     name="selected_size"
                     value="{{ talla }}"
                     class="visually-hidden">
              <span>{{ talla }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- ================= COLORES ================= -->
        {% if producto.color_visual_list %}
        <div class="mb-3">
          <label class="fw-bold">Colores:</label>
          <div class="d-flex gap-2 flex-wrap">
            {% for color in producto.color_visual_list %}
              <label class="option-chip color-chip">
                <input type="radio"
                      name="selected_color"
                      value="{{ color.nombre }}"
                      class="visually-hidden">
                <!-- Mostrar nombre encima del fondo -->
                <span style="background-color: {{ color.css }};
                            color: {% if color.nombre == 'Blanco' %}#000{% else %}#fff{% endif %};">
                  {{ color.nombre }}
                </span>
              </label>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- HIDDEN -->
        <input type="hidden" name="selected_size_hidden">
        <input type="hidden" name="selected_color_hidden">
        <input type="hidden" name="cantidad" value="1">

        <!-- BOTÃ“N -->
        <button type="submit"
                class="btn btn-primary mt-3 btn-agregar"
                disabled>
          <i class="bi bi-cart-plus"></i> Agregar al carrito
        </button>
      </form>
    </div>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/store.js' %}"></script>
{% endblock %}