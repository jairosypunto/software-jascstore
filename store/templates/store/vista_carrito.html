{% load static %}
<div class="carrito-galeria p-3" id="contenidoProducto">
    <div class="imagen-principal text-center mb-3" id="visor-principal">
        <img src="{% if producto.image %}{{ producto.image.url }}{% else %}{% static 'imgs/default-product.jpg' %}{% endif %}"
             class="img-fluid rounded shadow-sm" id="imagen-principal" style="max-height: 250px;">
    </div>

    <div class="miniaturas-abajo d-flex justify-content-center gap-2 mb-3 flex-wrap">
        {% if producto.image %}
        <div class="miniatura activa activa-azul" data-type="image" data-src="{{ producto.image.url }}" data-color="base" style="width: 55px; height: 55px; cursor: pointer; border: 2px solid #ddd;">
            <img src="{{ producto.image.url }}" style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        {% endif %}
        {% for img in producto.images.all %}
        <div class="miniatura" data-type="image" data-src="{{ img.image.url }}" data-color="{{ img.color_vinculado }}" style="width: 55px; height: 55px; cursor: pointer; border: 2px solid #ddd;">
            <img src="{{ img.image.url }}" style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        {% endfor %}
    </div>

    <form id="form-add-cart" onsubmit="return false;"> {% csrf_token %}
        <input type="hidden" name="selected_size_hidden" id="selected_size_hidden">
        <input type="hidden" name="selected_color_hidden" id="selected_color_hidden">
        <input type="hidden" name="imagen_seleccionada_url" id="imagen_seleccionada_url" value="{{ producto.image.url }}">

        {% if producto.talla_list %}
        <div class="mb-3">
            <label class="fw-bold small d-block mb-1">Talla:</label>
            <div class="d-flex gap-2 flex-wrap">
                {% for talla in producto.talla_list %}
                <button type="button" class="option-chip size-chip btn btn-sm btn-outline-dark">{{ talla }}</button>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if producto.color_list %}
        <div class="mb-3">
            <label class="fw-bold small d-block mb-1">Color:</label>
            <div class="d-flex gap-2 flex-wrap">
                {% for color in producto.color_list %}
                <button type="button" class="option-chip color-chip btn btn-sm btn-outline-dark">{{ color }}</button>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <button type="button" id="agregarDesdeModal" data-id="{{ producto.id }}"
                class="btn btn-success w-100 py-2 fw-bold btn-agregar" disabled>
            ðŸ›’ Agregar al carrito
        </button>
    </form>
</div>

<script>
    (function() {
        const cont = document.getElementById('contenidoProducto');
        if (window.initVistaRapida) {
            window.initVistaRapida(cont);
        }
    })();
</script>