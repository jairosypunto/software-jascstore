{% load humanize %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <style>
    /* Estilos Base Azul JascStore */
    body { font-family: 'Helvetica', Arial, sans-serif; font-size: 12px; margin: 0; padding: 40px; color: #1a237e; }
    .header-bar { background-color: #1a237e; height: 8px; margin: -40px -40px 30px -40px; }
    
    h2 { color: #1a237e; font-size: 22px; border-bottom: 2px solid #1a237e; padding-bottom: 10px; text-transform: uppercase; }
    h3 { color: #3949ab; font-size: 14px; margin-top: 25px; border-left: 4px solid #1a237e; padding-left: 10px; }
    
    .info-container { width: 100%; margin-bottom: 20px; }
    .info-box { width: 48%; display: inline-block; vertical-align: top; }
    
    table { width: 100%; border-collapse: collapse; margin-top: 15px; table-layout: fixed; }
    th { background-color: #1a237e; color: white; padding: 10px; text-align: left; font-size: 11px; text-transform: uppercase; }
    td { border-bottom: 1px solid #e0e0e0; padding: 10px; vertical-align: middle; }
    
    .col-imagen { width: 15%; }
    .col-producto { width: 35%; }
    .col-cantidad { width: 10%; text-align: center; }
    .col-unitario { width: 20%; text-align: right; }
    .col-subtotal { width: 20%; text-align: right; font-weight: bold; }

    .img-producto { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; border: 1px solid #ddd; }

    .text-right { text-align: right; }
    .text-muted { color: #7f8c8d; font-size: 10px; }
    .text-success { color: #1a237e; font-weight: bold; font-size: 18px; }
    .badge-status { padding: 4px 8px; border-radius: 4px; font-weight: bold; color: white; }
    .bg-pendiente { background-color: #e67e22; }
    .bg-pagado { background-color: #27ae60; }
    .bg-fallido { background-color: #c0392b; }

    .btn-whatsapp {
      display: inline-block;
      background-color: #25D366;
      color: white;
      padding: 10px 20px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="header-bar"></div>

  <div class="info-container">
    <div class="info-box">
      <h1 style="color: #1a237e; margin: 0;">JascStore</h1>
      <p class="text-muted">NIT: 900.000.000-1<br>Contacto: +57 301 617 3378</p>
    </div>
    <div class="info-box text-right">
      <h2 style="border: none; margin: 0;">Factura #{{ factura.id }}</h2>
      <p><strong>Fecha:</strong> {{ factura.fecha|date:"d/m/Y H:i" }}</p>
      <p><strong>Estado:</strong> 
        <span class="badge-status {% if factura.estado_pago == 'Pagado' or factura.estado_pago == 'Aprobado' %}bg-pagado{% elif factura.estado_pago == 'Pendiente' %}bg-pendiente{% else %}bg-fallido{% endif %}">
          {{ factura.estado_pago|upper }}
        </span>
      </p>
    </div>
  </div>

  <div class="info-container" style="background-color: #f9f9f9; padding: 15px; border-radius: 8px;">
    <div class="info-box">
      <h3>üìç Datos de Env√≠o</h3>
      <p><strong>Cliente:</strong> {{ factura.nombre }}</p>
      <p><strong>Direcci√≥n:</strong> {{ factura.direccion }}</p>
      <p><strong>Ciudad:</strong> {{ factura.ciudad }}, {{ factura.departamento }}</p>
    </div>
    <div class="info-box">
      <h3>üí≥ Detalles de Pago</h3>
      <p><strong>M√©todo:</strong> {{ factura.metodo_pago|capfirst }}</p>
      <p><strong>Email:</strong> {{ factura.email }}</p>
      <p><strong>Tel√©fono:</strong> {{ factura.telefono }}</p>
    </div>
  </div>

  <h3>üõç Detalles del pedido</h3>
  <table>
    <thead>
      <tr>
        <th class="col-imagen">Foto</th>
        <th class="col-producto">Producto</th>
        <th class="col-cantidad">Cant.</th>
        <th class="col-unitario">V. Unitario</th>
        <th class="col-subtotal">Subtotal</th>
      </tr>
    </thead>
    <tbody>
      {% for detalle in factura.detalles.all %}
      <tr>
        <td class="col-imagen">
          {% if detalle.imagen_url %}
            <img src="{{ detalle.imagen_url }}" class="img-producto">
          {% elif detalle.producto.imagen %}
            <img src="{{ detalle.producto.imagen.url }}" class="img-producto">
          {% else %}
            <div style="width:60px; height:60px; background:#eee; border-radius:6px; display: flex; align-items: center; justify-content: center; font-size: 8px; color: #999;">Sin Foto</div>
          {% endif %}
        </td>
        <td class="col-producto">
          <strong style="font-size: 11px; color: #1a237e;">
            {% if detalle.nombre_producto %}
                {{ detalle.nombre_producto|upper }}
            {% else %}
                {{ detalle.producto.name|upper }}{{ detalle.producto.nombre|upper }}
            {% endif %}
          </strong><br>
          <span class="text-muted">Talla: {{ detalle.talla }} | Color: {{ detalle.color }}</span>
        </td>
        <td class="col-cantidad">{{ detalle.cantidad }}</td>
        <td class="col-unitario">
          {% widthratio detalle.subtotal detalle.cantidad 1 as precio_u %}
          ${{ precio_u|intcomma }}
        </td>
        <td class="col-subtotal">${{ detalle.subtotal|floatformat:0|intcomma }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="text-right" style="margin-top: 30px; border-top: 2px solid #1a237e; padding-top: 10px;">
    <p style="font-size: 14px; margin-bottom: 5px;"><strong>Total de la compra:</strong></p>
    <p class="text-success">${{ factura.total|floatformat:0|intcomma }}</p>
    <p class="text-muted">Precios expresados en Pesos Colombianos (COP).</p>
  </div>

  <div style="text-align: center; margin-top: 40px;">
    <p>¬øTienes dudas con tu pedido?</p>
    <a href="https://wa.me/573016173378?text=Hola%20JascStore!%20Tengo%20una%20duda%20sobre%20mi%20factura%20{{ factura.id }}" class="btn-whatsapp">
      üí¨ Escr√≠benos por WhatsApp
    </a>
    <p class="text-muted" style="margin-top: 25px;">
      Esta factura electr√≥nica es un soporte de compra en JascStore.<br>
      Gracias por confiar en nosotros.
    </p>
  </div>
</body>
</html>