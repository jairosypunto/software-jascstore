{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5 mb-5">
  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-header bg-success text-white">
      <h4 class="mb-0">ğŸ§¾ Factura #{{ factura.id }}</h4>
    </div>
    <div class="card-body">
      <p><strong>ğŸ“… Fecha de emisiÃ³n:</strong> {{ factura.fecha|date:"d M Y H:i" }}</p>
      <p><strong>ğŸ‘¤ Cliente:</strong> {{ user.first_name|default:user.username }}</p>
      <p><strong>ğŸ’³ Estado del pago:</strong>
        {% if estado_pago == "Pendiente" %}
          <span class="text-warning fw-bold">Pendiente</span>
        {% else %}
          <span class="text-success fw-bold">Pagado</span>
        {% endif %}
      </p>
      <p><strong>ğŸ’° MÃ©todo de pago:</strong> {{ factura.metodo_pago }}</p>
      {% if factura.banco %}
        <p><strong>ğŸ¦ Banco utilizado:</strong> {{ factura.banco }}</p>
      {% endif %}
      <p><strong>ğŸ” ID de transacciÃ³n:</strong> {{ factura.transaccion_id|default:"No disponible" }}</p>

      <hr>

      <h5 class="fw-bold text-secondary">ğŸ› Detalles del pedido</h5>
      <table class="table table-bordered text-center align-middle">
        <thead class="table-light">
          <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Precio unitario</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>{{ item.producto.name }}</td>
            <td>{{ item.cantidad }}</td>
            <td>
              {% if item.producto.discount > 0 %}
                ${{ item.producto.final_price|floatformat:0 }}
                <small class="text-muted d-block">
                  <span class="text-decoration-line-through">${{ item.producto.cost|floatformat:0 }}</span>
                  (-{{ item.producto.discount }}%)
                </small>
              {% else %}
                ${{ item.producto.cost|floatformat:0 }}
              {% endif %}
            </td>
            <td>${{ item.subtotal|floatformat:0 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="text-end mt-4">
        <p><strong>Subtotal:</strong> ${{ subtotal|floatformat:0 }}</p>
        <p><strong>IVA (19%):</strong> ${{ iva|floatformat:0 }}</p>
        <p><strong>Descuento:</strong> -${{ descuento|floatformat:0 }}</p>
        <h5 class="mt-3">ğŸ’µ Total pagado: <span class="text-success">${{ total_final|floatformat:0 }}</span></h5>
      </div>

      <hr>

      <p class="text-muted">Gracias por tu compra. Tu pedido serÃ¡ procesado y enviado en las prÃ³ximas 24-48 horas.</p>
      <p class="text-muted">Factura validada electrÃ³nicamente â€“ LatinShop 2025</p>

      <a href="{% url 'store:store' %}" class="btn btn-outline-primary mt-3">Volver a la tienda</a>
    </div>
  </div>
</div>
{% endblock %}