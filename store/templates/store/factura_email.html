{% load humanize %}

<!-- üßæ Encabezado de la factura -->
<h2 style="color:#2c3e50;">Factura #{{ factura.id }}</h2>
<p>Hola {{ factura.nombre|default:factura.usuario.username }}, gracias por tu compra.</p>

<!-- üì¶ Datos de env√≠o -->
<h3 style="color:#27ae60;">üì¶ Datos de env√≠o</h3>
<p><strong>Nombre:</strong> {{ factura.nombre }}</p>
<p><strong>Email:</strong> {{ factura.email }}</p>
<p><strong>Tel√©fono:</strong> {{ factura.telefono }}</p>
<p><strong>Direcci√≥n:</strong> {{ factura.direccion }}</p>
<p><strong>Ciudad:</strong> {{ factura.ciudad }}</p>
<p><strong>Departamento:</strong> {{ factura.departamento }}</p>

<!-- üí∞ Totales principales -->
<h3 style="color:#2980b9;">üí∞ Totales</h3>
<p><strong>Total pagado:</strong> ${{ total_final|intcomma }}</p>
<p><strong>Fecha de compra:</strong> {{ factura.fecha|date:"d/m/Y H:i" }}</p>
<p><strong>Estado del pago:</strong> {{ factura.estado_pago }}</p>
<p><strong>M√©todo de pago:</strong> {{ factura.metodo_pago }}</p>

<!-- üè¶ Banco utilizado (solo si aplica) -->
{% if factura.banco %}
  <p><strong>Banco utilizado:</strong> {{ factura.banco }}</p>
{% endif %}

<!-- üõç Detalles del pedido -->
<h3 style="color:#8e44ad;">üõç Detalles del pedido:</h3>
<table style="width:100%; border-collapse: collapse; font-size:13px;" border="1" cellpadding="6" cellspacing="0">
  <thead>
    <tr style="background-color:#f2f2f2;">
      <th style="text-align:left; padding:8px;">Producto</th>
      <th style="text-align:center; padding:8px;">Cantidad</th>
      <th style="text-align:right; padding:8px;">Subtotal</th>
    </tr>
  </thead>
  <tbody>
    {% for item in factura.detalles.all %}
    <tr>
      <td style="padding:8px;">
        {{ item.producto.name }}
        {% if item.talla or item.color %}
          <div style="font-size:11px; color:#555;">
            {% if item.talla %}Talla: {{ item.talla }}{% endif %}
            {% if item.talla and item.color %} | {% endif %}
            {% if item.color %}Color: {{ item.color }}{% endif %}
          </div>
        {% endif %}
      </td>
      <td style="text-align:center; padding:8px;">{{ item.cantidad }}</td>
      <td style="text-align:right; padding:8px;">${{ item.subtotal|intcomma }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- üí∞ Resumen de totales -->
<p><strong>Subtotal:</strong> ${{ subtotal|intcomma }}</p>
<p><strong>IVA (19%):</strong> ${{ iva|intcomma }}</p>
<p><strong>Descuento aplicado:</strong> ${{ descuento|intcomma }}</p>

<!-- üèÅ Total final -->
<p style="font-size:16px; font-weight:bold; color:#000;">
  <strong>Total final:</strong> ${{ total_final|intcomma }}
</p>

<!-- üìå Nota final -->
<p style="margin-top:20px; font-size:13px; color:#555;">
  Esta factura ha sido generada electr√≥nicamente por <strong>JascEcommerce</strong> y es v√°lida sin firma.<br>
  Gracias por confiar en nosotros. Esperamos que disfrutes tu compra.
</p>