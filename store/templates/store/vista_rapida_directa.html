{% load static humanize %}

<div class="vista-directa">

  <!-- =====================================================
       ðŸ“¸ GALERÃA (IMÃGENES + VIDEO)
  ====================================================== -->
  <div class="galeria-producto">

    <!-- VISOR PRINCIPAL -->
    <div class="imagen-principal" id="visor-principal">

      {% if producto.image %}
        <img src="{{ producto.image.url }}"
             class="big-image"
             alt="{{ producto.name }}">
      {% else %}
        <img src="{% static 'icons/no-image.png' %}"
             class="big-image"
             alt="Sin imagen">
      {% endif %}

    </div>

    <!-- MINIATURAS -->
    <div class="miniaturas horizontal">
      {% if producto.video_file %}
        <div class="miniatura video-thumb"
            data-type="video"
            data-src="{{ producto.video_file.url }}"
            {% if producto.video_thumb %}
              style="background-image:url('{{ producto.video_thumb.url }}')"
            {% endif %}>
          <span class="play-icon">â–¶</span>
        </div>
      {% endif %}



      {# Imagen principal #}
      {% if producto.image %}
        <img src="{{ producto.image.url }}"
             class="miniatura activa"
             data-type="image"
             data-src="{{ producto.image.url }}"
             alt="Imagen principal">
      {% endif %}

      {# ImÃ¡genes adicionales #}
      {% for img in producto.images.all %}
        <img src="{{ img.image.url }}"
             class="miniatura"
             data-type="image"
             data-src="{{ img.image.url }}"
             alt="Imagen adicional">
      {% endfor %}

      {# ðŸŽ¥ Video del producto #}
      {% if producto.video %}
        <div class="miniatura video-thumb"
             data-type="video"
             data-src="{{ producto.video.url }}"
             title="Ver video">
          â–¶
        </div>
      {% endif %}

    </div>

  </div>

  <!-- =====================================================
       â„¹ï¸ INFORMACIÃ“N DEL PRODUCTO
  ====================================================== -->
  <div class="info-producto">

    <h3 class="titulo">{{ producto.name }}</h3>

    <!-- ðŸ’° PRECIOS -->
    {% if producto.discount > 0 %}
      <div class="precio">
        <span class="precio-final">${{ producto.final_price|intcomma }}</span>
        <span class="precio-original">${{ producto.cost|intcomma }}</span>
        <span class="badge-descuento">-{{ producto.discount }}%</span>
      </div>
    {% else %}
      <div class="precio">
        <span class="precio-final">${{ producto.cost|intcomma }}</span>
      </div>
    {% endif %}

    <!-- ðŸ‘• TALLAS (solo si existen) -->
    {% if producto.talla_list %}
    <div class="bloque-opciones">
      <label class="label-opcion">Tallas</label>
      <div class="opciones">
        {% for talla in producto.talla_list %}
        <label class="option-chip size-chip">
          <input type="radio"
                 name="selected_size_radio"
                 value="{{ talla }}"
                 class="visually-hidden">
          <span>{{ talla }}</span>
        </label>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- ðŸŽ¨ COLORES (solo si existen) -->
    {% if producto.colors_list %}
    <div class="bloque-opciones">
      <label class="label-opcion">Colores</label>
      <div class="opciones">
        {% for color in producto.colors_list %}
        <label class="option-chip color-chip">
          <input type="radio"
                 name="selected_color_radio"
                 value="{{ color }}"
                 class="visually-hidden">
          <span>{{ color }}</span>
        </label>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- ðŸ›’ FORMULARIO -->
    <form method="POST"
          action="{% url 'store:agregar_al_carrito' producto.id %}"
          id="form-add-cart">
      {% csrf_token %}

      <!-- Valores reales que lee Django -->
      <input type="hidden" name="selected_size_hidden">
      <input type="hidden" name="selected_color_hidden">
      <input type="hidden" name="cantidad" value="1">

      <button type="submit" class="btn-agregar" disabled>
        ðŸ›’ Agregar al carrito
      </button>
    </form>

  </div>
</div>
